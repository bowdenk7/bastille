// Generated by CoffeeScript 1.10.0
(function() {
  var _, argsMatch, callsStore, store, stubbingFor;

  _ = require('lodash');

  store = require('./index');

  callsStore = require('./calls');

  argsMatch = require('./../args-match');

  module.exports = {
    add: function(testDouble, args, stubbedValues) {
      return store["for"](testDouble).stubbings.push({
        stubbedValues: stubbedValues,
        args: args
      });
    },
    get: function(testDouble, args) {
      var callIndex, stubbing;
      if (!(stubbing = stubbingFor(testDouble, args))) {
        return;
      }
      callIndex = callsStore.where(testDouble, args).length - 1;
      if (callIndex < stubbing.stubbedValues.length) {
        return stubbing.stubbedValues[callIndex];
      } else {
        return _.last(stubbing.stubbedValues);
      }
    },
    "for": function(testDouble) {
      return store["for"](testDouble).stubbings;
    }
  };

  stubbingFor = function(testDouble, actualArgs) {
    return _(store["for"](testDouble).stubbings).findLast(function(stubbing) {
      return argsMatch(stubbing.args, actualArgs);
    });
  };

}).call(this);
